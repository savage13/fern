<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libfern: libfern Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfern
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Federated Earthquake Retrieval via Network</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libfern Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview </h2>
<p>The libfern library, assocated fern binary, and inferface in sac provides a interface to:</p><ul>
<li>event searches</li>
<li>download data (miniseed format)</li>
<li>station searches</li>
<li>apply station meta-data</li>
<li>apply event meta-data</li>
<li>search for available data</li>
<li>convert miniseed to sac</li>
<li>write miniseed and sac files</li>
</ul>
<h2>Examples using fern and libfern </h2>
<ul>
<li><a href="#Event-Search">Event Search</a></li>
<li><a href="#Station-Search">Station Search</a></li>
<li><a href="#Search-based-on-Event">Search based on Event</a></li>
<li><a href="#Data-Availability-Search">Data Availability Search</a></li>
<li><a href="#Data-Download-to-miniseed">Data Download to miniseed</a></li>
<li><a href="#Data-Download-to-sac">Data Download to sac</a></li>
<li><a href="#event-fern">Event Search with libfern</a></li>
<li><a href="#event-fern">Station Search with libfern</a></li>
<li><a href="#data-fern">Data Download with libfern</a></li>
</ul>
<h3><a class="anchor" id="Event-Search"></a>Event Search</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Event Search  </td><td class="markdownTableBodyNone"><code>-E</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Magntiude: 9 - 10  </td><td class="markdownTableBodyNone"><code>-m 9/10</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Time: 1950 - 2020  </td><td class="markdownTableBodyNone"><code>-t 1950/01/01 2020/01/01</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -E -m 9/10 -t 1950/01/01 2020/01/01</div><div class="line">Origin              Lat.   Lon.    Depth  Mag.     Agency EventID</div><div class="line">2011-03-11T05:46:24  38.30  142.37  29.00 9.10 mww US/official - usgs:official20110311054624120_30</div><div class="line">2004-12-26T00:58:53   3.29   95.98  30.00 9.10 mw  US/official - usgs:official20041226005853450_30</div><div class="line">1964-03-28T03:36:16  60.91 -147.34  25.00 9.20 mw  iscgem/official - usgs:official19640328033616_30</div><div class="line">1960-05-22T19:11:20 -38.14  -73.41  25.00 9.50 mw  iscgem/official - usgs:official19600522191120_30</div><div class="line">1952-11-04T16:58:30  52.62  159.78  21.60 9.00 mw  iscgem/official - usgs:official19521104165830_30</div></div><!-- fragment --><h3><a class="anchor" id="Station-Search"></a>Station Search</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Station Search  </td><td class="markdownTableBodyNone"><code>-S</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Time: 1999/01/01 - 1999/01/02  </td><td class="markdownTableBodyNone"><code>-t 1999/01/01 +1day</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Network: IU  </td><td class="markdownTableBodyNone"><code>-n IU</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">verbose: On  </td><td class="markdownTableBodyNone"><code>-v</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -S -t 1999/01/01 +1day -n IU</div><div class="line">Net Sta   Lat.     Lon.      Elev.   SiteName</div><div class="line">IU  ADK    51.8823 -176.6842  130.00 Adak, Aleutian Islands, Alaska</div><div class="line">IU  AFI   -13.9093 -171.7773  706.00 Afiamalu, Samoa</div><div class="line">IU  ANMO   34.9459 -106.4572 1850.00 Albuquerque, New Mexico, USA</div><div class="line">...</div><div class="line">IU  XMAS    2.0448 -157.4457   20.00 Kiritimati Island, Republic of Kiribati</div><div class="line">IU  YAK    62.0310  129.6805  110.00 Yakutsk, Russia</div><div class="line">IU  YSS    46.9587  142.7604  150.00 Yuzhno Sakhalinsk, Russia</div></div><!-- fragment --><h3><a class="anchor" id="Search-based-on-Event"></a>Search based on Event</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Event search  </td><td class="markdownTableBodyNone"><code>-E</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start time 160th day in 1994  </td><td class="markdownTableBodyNone"><code>-t 1994/160</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Magntiude 8 - 10  </td><td class="markdownTableBodyNone"><code>-m 8/10</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Station search  </td><td class="markdownTableBodyNone"><code>-S</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Time: event origin time  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Network: IU, XE  </td><td class="markdownTableBodyNone"><code>-n IU,XE</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Radial search from event to 35 degrees  </td><td class="markdownTableBodyNone"><code>-r0/35 -e usgs:usp0006dzc</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -E -t 1994/160 +1d -m 8/10</div><div class="line">Origin              Lat.   Lon.    Depth  Mag.     Agency EventID</div><div class="line">1994-06-09T00:33:16 -13.84  -67.55 631.30 8.20 mw  US/HRV - usgs:usp0006dzc</div><div class="line"></div><div class="line">fern -S -e usgs:usp0006dzc -n IU,XE -r0/35</div><div class="line">Net Sta   Lat.     Lon.      Elev.   SiteName</div><div class="line">IU  BOCO    4.5869  -74.0432 3160.00 Bogota, Colombia</div><div class="line">IU  SJG    18.1091  -66.1500  420.00 San Juan, Puerto Rico</div><div class="line">XE  CHIT  -20.0756  -66.8851 3862.00 -</div><div class="line">...</div><div class="line">XE  SICA  -17.2924  -67.7490 4065.00 -</div><div class="line">XE  TACA  -18.8279  -66.7331 3810.00 -</div><div class="line">XE  YUNZ  -19.1581  -65.0700 2896.00 -</div><div class="line"></div><div class="line"># Equivalent to the following</div><div class="line">fern -S -t 1994-06-09T00:33:16 +0m  -n IU,XE -O -67.55/-13.84  -r0/35</div><div class="line">Net Sta   Lat.     Lon.      Elev.   SiteName</div><div class="line">IU  BOCO    4.5869  -74.0432 3160.00 Bogota, Colombia</div><div class="line">IU  SJG    18.1091  -66.1500  420.00 San Juan, Puerto Rico</div><div class="line">XE  CHIT  -20.0756  -66.8851 3862.00 -</div><div class="line">...</div><div class="line">XE  SICA  -17.2924  -67.7490 4065.00 -</div><div class="line">XE  TACA  -18.8279  -66.7331 3810.00 -</div><div class="line">XE  YUNZ  -19.1581  -65.0700 2896.00 -</div></div><!-- fragment --><h3><a class="anchor" id="Data-Availability-Search"></a>Data Availability Search</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Start time: Event origin time  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">End time: Event origin time +30 minutes  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc -d +30m</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Network: XE  </td><td class="markdownTableBodyNone"><code>-n XE</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Channel: BHZ  </td><td class="markdownTableBodyNone"><code>-c BHZ</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -D available  -e &#39;usgs:usp0006dzc&#39; -n XE -d +30m -c BHZ</div><div class="line">## REQUEST 1/ 1</div><div class="line">DATACENTER=IRISDMC,http://ds.iris.edu</div><div class="line">XE CHIT -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div><div class="line">XE CHUQ -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div><div class="line">XE COLL -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div><div class="line">...</div><div class="line">XE SICA -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div><div class="line">XE TACA -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div><div class="line">XE YUNZ -- BHZ 1994-06-09T00:33:16 1994-06-09T01:03:16</div></div><!-- fragment --><h3><a class="anchor" id="Data-Download-to-miniseed"></a>Data Download to miniseed</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Download miniseed data  </td><td class="markdownTableBodyNone"><code>-D miniseed</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start time from event origin  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">End time from event origin + 30 minutes  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc -d +30m</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Network: XE  </td><td class="markdownTableBodyNone"><code>-n XE</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Channel: BHZ  </td><td class="markdownTableBodyNone"><code>-n BHZ</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -D miniseed   -e &#39;usgs:usp0006dzc&#39; -n XE -d +30m -c BHZ</div><div class="line">Data Center: IRISDMC,http://ds.iris.edu</div><div class="line">        Writing data to fdsnws.2019.07.20.10.56.28.IRISDMC.mseed [968.00 KiB]</div></div><!-- fragment --><h3><a class="anchor" id="Data-Download-to-sac"></a>Data Download to sac</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Argument   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Download miniseed data  </td><td class="markdownTableBodyNone"><code>-D sac</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start time from event origin  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">End time from event origin + 30 minutes  </td><td class="markdownTableBodyNone"><code>-e usgs:usp0006dzc -d +30m</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Network: XE  </td><td class="markdownTableBodyNone"><code>-n XE</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Channel: BHZ  </td><td class="markdownTableBodyNone"><code>-n BHZ</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Station: DOOR  </td><td class="markdownTableBodyNone"><code>-s DOOR</code>   </td></tr>
</table>
<div class="fragment"><div class="line">fern -D sac   -e &#39;usgs:usp0006dzc&#39; -n XE -v -d +30m -c BHZ -s DOOR</div><div class="line">Data Center: IRISDMC,http://ds.iris.edu</div><div class="line">Working on file: XE.DOOR..BHZ.M.1994.160.003321.sac [ OK ]</div><div class="line">        Writing data to XE.DOOR..BHZ.M.1994.160.003321.sac [ 70.73 KiB]</div></div><!-- fragment --><h4>Meta Data Insertion</h4>
<p><b>Station meta data</b> is autoomatically set if sac conversion is requested:</p><ul>
<li>Station Latitude (stla)</li>
<li>Station Longitude (stlo)</li>
<li>Station Elevation (stel)</li>
<li>Station Depth (stdp) , always 0.0</li>
<li>Component Azimuth (cmpaz)</li>
<li>Component Inclination (cmpinc)</li>
</ul>
<p><b>Event meta data</b> is automatically set of an event parameter is used and sac conversion is requested:</p><ul>
<li>Event Latitude (evla)</li>
<li>Event Longitude (evlo)</li>
<li>Event Depth (evdp)</li>
<li>Event Elevation (evel), always 0.0</li>
<li>Event Name (kevnm)</li>
<li>Origin Time (kzdate, kztime)</li>
<li>Reference Time (iztype) set to IO, i.e. event origin time</li>
<li>All other times are shifted to the reference time</li>
<li>The following are computed:<ul>
<li>Distance (dist)</li>
<li>Great Circle Arc (gcarc)</li>
<li>Azimuth (az)</li>
<li>Back azimuth (baz)</li>
</ul>
</li>
</ul>
<h2>Examples using libfern </h2>
<h4><a class="anchor" id="event-fern"></a>Event Search with libfern</h4>
<div class="fragment"><div class="line"><span class="comment">// Contstruct a request</span></div><div class="line"><span class="comment">//  Magnitude: 8 - 10</span></div><div class="line"><span class="comment">//  Time:      1994/160 - 1994/161</span></div><div class="line"><span class="comment">//  Depth:     400.0 - 700.0 km</span></div><div class="line"><span class="comment">//  Verbose:   On</span></div><div class="line">request *r = event_request_new();</div><div class="line"><a class="code" href="group__request.html#ga56bfdbf65c9f890cf835fde6065ea723">request_set_url</a>(r, <span class="stringliteral">&quot;https://earthquake.usgs.gov/fdsnws/event/1/query?&quot;</span>);</div><div class="line">request_set_mag(r, 8.0, 10.0);</div><div class="line">request_set_depth(r, 400.0, 700.0);</div><div class="line">request_set_time_range(r, timespec64_from_yjhmsf(1994, 160, 0, 0, 0, 0),</div><div class="line">                          timespec64_from_yjhmsf(1994, 161, 0, 0, 0, 0));</div><div class="line">result_set_verbose(r, 1);</div><div class="line"></div><div class="line"><span class="comment">// Get request and check result</span></div><div class="line">result *res = <a class="code" href="group__request.html#ga1e4b11fcbfc73ad07fb5500614def65b">request_get</a>(r);</div><div class="line"><span class="keywordflow">if</span>(!<a class="code" href="group__request.html#ga621c6fb014e93e11ef272d2573b79ab1">result_is_ok</a>(res)) {</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"><span class="comment">// Parse quake xml output</span></div><div class="line"><span class="keywordtype">int</span> verbose = 1;</div><div class="line">cat catalog[5] = <span class="stringliteral">&quot;usgs&quot;</span>;</div><div class="line">Events **ev = <a class="code" href="group__events.html#gaa2e6a65b7bd70c699e23513af12c50f6">quake_xml_parse</a>(<a class="code" href="group__request.html#ga31de58785acc59a969277320b09b7178">result_data</a>(res), <a class="code" href="group__request.html#gac627e0b345acc5f2ba3bffb9463513ef">result_len</a>(res), verbose, catalog);</div><div class="line"></div><div class="line"><span class="comment">// Print out the events</span></div><div class="line"><a class="code" href="group__events.html#gac810f1a885c905fd3a0f9dac8b5f546f">events_write</a>(ev, stdout);</div></div><!-- fragment --><h4><a class="anchor" id="station-fern"></a>Station Search with libfern</h4>
<div class="fragment"><div class="line"><span class="comment">// Construct a request</span></div><div class="line"><span class="comment">// Time:     1994/160 - 1994/161</span></div><div class="line"><span class="comment">// Network:  XE</span></div><div class="line"><span class="comment">// Channel:  BH?</span></div><div class="line"><span class="comment">// Region:   -180/180/-90/0</span></div><div class="line"></div><div class="line">request *r = station_request_new();</div><div class="line"><a class="code" href="group__stations.html#ga9d9580b03b0b0023dc913ce2980bc3db">station_req_set_time_range</a>(r, timespec64_from_yjhmsf(1994, 160, 0, 0, 0, 0),</div><div class="line">                              timespec64_from_yjhmsf(1994, 161, 0, 0, 0, 0));</div><div class="line"><a class="code" href="group__stations.html#ga1a7e243555e7ee954c96be45e1abffa7">station_req_set_network</a>(r, <span class="stringliteral">&quot;XE&quot;</span>);</div><div class="line">station_rea_set_channel(r, <span class="stringliteral">&quot;BH?&quot;</span>);</div><div class="line">request_req_set_region(r, -180.0, 180.0, -90.0, 0.0);</div><div class="line"><a class="code" href="group__request.html#gac803c256f9413f5368c568731c00c178">request_set_verbose</a>(r, 1);</div><div class="line"></div><div class="line"><span class="comment">// Get request and check result</span></div><div class="line">result *res = <a class="code" href="group__request.html#ga1e4b11fcbfc73ad07fb5500614def65b">request_get</a>(r);</div><div class="line"><span class="keywordflow">if</span>(!<a class="code" href="group__request.html#ga621c6fb014e93e11ef272d2573b79ab1">result_is_ok</a>(res)) {</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"><span class="comment">// Parse station xml output</span></div><div class="line"><span class="keywordtype">int</span> verbose   = 1;</div><div class="line"><span class="keywordtype">int</span> epochs    = 1;</div><div class="line"><span class="keywordtype">int</span> show_time = 1;</div><div class="line"><a class="code" href="structstation.html">station</a> **st = <a class="code" href="group__stations.html#ga7db5ac8d6717d2659b661746b2d31778">station_xml_parse</a>(<a class="code" href="group__request.html#ga31de58785acc59a969277320b09b7178">result_data</a>(res), <a class="code" href="group__request.html#gac627e0b345acc5f2ba3bffb9463513ef">result_len</a>(res), epochs, verbose);</div><div class="line"></div><div class="line"><span class="comment">// Print out the stations</span></div><div class="line">station_write(st, show_time, stdout);</div></div><!-- fragment --><h4><a class="anchor" id="data-fern"></a>Data Download with libfern</h4>
<div class="fragment"><div class="line"><span class="comment">// Create a Data Request</span></div><div class="line"><span class="comment">// Origin(Lon, Lat):  -67.55, -13.84  (Deep Bolivia Event 1994)</span></div><div class="line"><span class="comment">// Time:              1994/160 00:33:16 - 1994/160 01:03:16</span></div><div class="line"><span class="comment">// Network:           IU,XE</span></div><div class="line"><span class="comment">// Radius:            0 - 35 degrees</span></div><div class="line"></div><div class="line">Event *ev = event_from_event_id(<span class="stringliteral">&quot;usgs:usp0006dzc&quot;</span>);</div><div class="line"></div><div class="line">request *r = <a class="code" href="group__data.html#ga87364759f115622bef4e36baee58e896">data_avail_new</a>();</div><div class="line"><a class="code" href="group__data.html#gababb117c1a44935a5f0be735120b3077">data_avail_set_origin</a>(r, -67.55, -13.84);</div><div class="line"></div><div class="line"><span class="comment">// Alternative using an event (Location)</span></div><div class="line"><span class="comment">// data_avail_set_origin(r, event_lon(ev), event_lat(ev));</span></div><div class="line"></div><div class="line"><a class="code" href="group__data.html#gad494b2f20293fe0e85985f590beda02f">data_avail_set_radius</a>(r, 0.0, 35.0);</div><div class="line"><a class="code" href="group__data.html#ga0f32e72b39c1895a0d2c4c92e2926fdf">data_avail_set_network</a>(r, <span class="stringliteral">&quot;IU,XE&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="group__data.html#ga9585f2f5e5ce30806f8e6a51676ac853">data_avail_set_time_range</a>(r, timespec64_from_yjhmsf(1994, 160, 0, 33, 16, 0),</div><div class="line">                             timespec64_from_yjhmsf(1994, 161, 1, 03, 16, 0));</div><div class="line"><span class="comment">// Alternative using the event (time)</span></div><div class="line"><span class="comment">// duration d = { 0, 0 };</span></div><div class="line"><span class="comment">// duration_parse(&amp;d, &quot;30m&quot;);</span></div><div class="line"><span class="comment">// timespec64 start = event_time(ev);</span></div><div class="line"><span class="comment">// timespec64 end   = timespec64_add_duration(start, &amp;dur);</span></div><div class="line"><span class="comment">// data_avail_set_time(r, start, end);</span></div><div class="line"></div><div class="line"><a class="code" href="group__request.html#gac803c256f9413f5368c568731c00c178">request_set_verbose</a>(r, 1);</div><div class="line"></div><div class="line"><span class="comment">// Get request and check result</span></div><div class="line">result *res = <a class="code" href="group__request.html#ga1e4b11fcbfc73ad07fb5500614def65b">request_get</a>(r);</div><div class="line"><span class="keywordflow">if</span>(!<a class="code" href="group__request.html#ga621c6fb014e93e11ef272d2573b79ab1">result_is_ok</a>(res)) {</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Parse the result into a data request</span></div><div class="line">data_request *dr = <a class="code" href="group__data.html#ga78e7097a5b74a20e32123c2b493b2778">data_request_parse</a>( <a class="code" href="group__request.html#ga31de58785acc59a969277320b09b7178">result_data</a>(res) );</div><div class="line"></div><div class="line"><span class="comment">// Print a formatted data request</span></div><div class="line"><a class="code" href="group__data.html#ga16e9f233d0bf0e1f8c06111e2de75784">data_request_write</a>(dr, stdout);</div><div class="line"></div><div class="line"><span class="comment">// Write the data request to an actual file (optional)</span></div><div class="line"><span class="comment">// data_request_write_to_file(dr, &quot;data.request&quot;);</span></div><div class="line"></div><div class="line"><span class="comment">// The request can be split into multiple pieces based on request size in MB</span></div><div class="line"><span class="comment">//    Optional, but can be useful for long duration requests that last longer</span></div><div class="line">/     than a traditional earthquake record.  It is ok, the libmseed library can</div><div class="line"><span class="comment">//    magically merge the request files back together again, provided there</span></div><div class="line"><span class="comment">//    are no data gaps.</span></div><div class="line"><span class="comment">// data_request_chunks(dr, 100);</span></div><div class="line"></div><div class="line"><span class="comment">// Download the data !!!</span></div><div class="line"></div><div class="line"><span class="comment">// Download the all of the requests</span></div><div class="line">MS3TraceList *mst3k = NULL;</div><div class="line"><span class="keywordtype">int</span> save_files  = 1;</div><div class="line"><span class="keywordtype">int</span> unpack_data = 1;</div><div class="line">mst3k = <a class="code" href="group__data.html#gae1a6612412eec9af55f09c1f95c3c45c">data_request_download</a>(dr, <span class="stringliteral">&quot;data.request&quot;</span>, <span class="stringliteral">&quot;miniseed_prefix&quot;</span>,</div><div class="line">                              save_files, unpack_data);</div><div class="line"></div><div class="line"><span class="comment">// Convert miniseed trace list to sac files</span></div><div class="line">sac **s = NULL;</div><div class="line">s = <a class="code" href="group__miniseed.html#ga1fab4ea7299546e6f1bf7fafcc812cf0">miniseed_trace_list_to_sac</a>(mst3k);</div><div class="line"></div><div class="line"><span class="comment">// Insert station meta data for sac files</span></div><div class="line"><span class="keywordtype">int</span> verbose = 1;</div><div class="line"><a class="code" href="group__meta.html#ga0f20c7d26d297a81d77bd2468b4e3a86">sac_array_fill_meta_data</a>(s, verbose);</div><div class="line"><span class="comment">// Or from a file</span></div><div class="line"><span class="comment">// sac_fill_meta_data_from_file(s, verbose, &quot;station.xml&quot;);</span></div><div class="line"><span class="comment">// sac_fill_meta_data_from_file(s, verbose, &quot;station.json&quot;);</span></div><div class="line"></div><div class="line"><span class="comment">// Insert event meta data if event is available</span></div><div class="line"><span class="comment">// Use the Bolivian Event from above</span></div><div class="line"><a class="code" href="group__meta.html#ga712f9982f9e52e9dc78c0169b40d7dbf">sac_array_fill_meta_data_from_event</a>(s, ev, verbose);</div><div class="line"></div><div class="line"><span class="comment">// Calculate distance, azimuth, ...</span></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="group__array.html#ga506af6bb70cc5dc4c0a7514e011f57a9">xarray_length</a>(s); i++) {</div><div class="line">   update_distaz(s[i]);  <span class="comment">// Function in sacio</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Write out sac files</span></div><div class="line"><span class="comment">//   A filename is defined in an extra meta data sac header</span></div><div class="line"><span class="comment">//   The extra meta data is not written out to the file</span></div><div class="line"><span class="keywordtype">int</span> nerr = 0;</div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="group__array.html#ga506af6bb70cc5dc4c0a7514e011f57a9">xarray_length</a>(s); i++) {</div><div class="line">   sac_write(s[i], s[i]-&gt;m-&gt;filename, &amp;nerr);</div><div class="line">}</div></div><!-- fragment --><h2>Requirements </h2>
<ul>
<li>libmseed - <a href="https://github.com/iris-edu/libmseed">https://github.com/iris-edu/libmseed</a></li>
<li>libsacio (IRIS/LLNL) - <a href="http://ds.iris.edu/ds/nodes/dmc/forms/sac/">http://ds.iris.edu/ds/nodes/dmc/forms/sac/</a></li>
<li>libsacio (BSD) - <a href="http://https://github.com/savage13/sacio">http://https://github.com/savage13/sacio</a></li>
<li>libcurl - <a href="https://curl.haxx.se/libcurl/">https://curl.haxx.se/libcurl/</a> (On most systems)</li>
<li>libxml2 - <a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a> (On most systems)</li>
<li>cJSON - <a href="https://github.com/DaveGamble/cJSON">https://github.com/DaveGamble/cJSON</a> (Included)</li>
<li>64-bit time <a href="https://github.com/evalEmpire/y2038">https://github.com/evalEmpire/y2038</a> (Included)</li>
</ul>
<h2>Downloading and installing </h2>
<p>Please report issues to the project.</p>
<p>If you would like to contribute to the project please file Pull Requests and/or create issues for discussion at the libfern project.</p>
<h2>License </h2>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this software except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div></div><!-- contents -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/savage13/fern" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<!--<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>-->
